generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String
  email         String    @unique
  password      String
  role          Role      @default(USER)
  phone         String?
  dni           String?   @unique
  address       String?
  birthDate     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  appointments  Appointment[]
  medicalRecords MedicalRecord[]
}

enum Role {
  ADMIN
  USER
}

model Appointment {
  id          String            @id @default(cuid())
  userId      String
  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  date        DateTime
  time        String
  status      AppointmentStatus @default(PENDING)
  notes       String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  
  medicalRecord MedicalRecord?
  
  @@index([userId])
  @@index([date])
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
}

model MedicalRecord {
  id              String      @id @default(cuid())
  appointmentId   String      @unique
  appointment     Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  diagnosis       String
  treatment       String
  observations    String?
  images          String[]    // Array de URLs de imágenes
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([userId])
}

model AvailableSlot {
  id          String   @id @default(cuid())
  dayOfWeek   Int      // 0-6 (Domingo-Sábado)
  time        String   // "09:00", "10:00", etc.
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([dayOfWeek, time])
}

model SiteContent {
  id          String   @id @default(cuid())
  section     String   @unique // "hero", "services", "about", etc.
  title       String?
  content     String?
  images      String[] // Array de URLs
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}